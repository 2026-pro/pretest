<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ê´€ë¦¬ì ë¡œê·¸ì¸</title>
  <link rel="stylesheet" href="./assets/css/layout.css">
  <link rel="stylesheet" href="./assets/css/form.css">
  <link rel="stylesheet" href="./assets/css/admin-login.css">
</head>
<body>
  <div id="wrap">
    <div id="header-container"></div>
    <script src="./assets/js/header.js"></script>

    <main id="content">
      <div class="inner">
        <h1>ê´€ë¦¬ì ë¡œê·¸ì¸</h1>
        <form id="admin-login-form">
          <label>ì•„ì´ë”” (ID)<input name="id" required></label>
          <label>ë¹„ë°€ë²ˆí˜¸ (Password)<input type="password" name="password" required></label>
          <button type="submit">ë¡œê·¸ì¸</button>
        </form>
        <div id="login-msg" aria-live="polite"></div>
      </div>
    </main>

    <div id="footer-container"></div>
    <script src="./assets/js/footer.js"></script>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bcryptjs/2.4.3/bcryptjs.min.js"></script>

  <script src="./assets/js/supabase-config.js"></script>
  
  <script>
    document.addEventListener('DOMContentLoaded', () => {
        const form = document.getElementById('admin-login-form');
        const msg = document.getElementById('login-msg');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const id = form.id.value.trim();
            const password = form.password.value.trim();
            
            msg.textContent = 'ë¡œê·¸ì¸ í™•ì¸ ì¤‘...';
            msg.style.color = '#666';

            try {
                // ì „ì—­ Supabase í´ë¼ì´ì–¸íŠ¸ ì¸ìŠ¤í„´ìŠ¤ í™•ì¸ (ë¼ì´ë¸ŒëŸ¬ë¦¬ ê°ì²´(window.supabase)ê°€ ì•„ë‹˜)
                const sb = window.supabaseInstance;

                if (!sb) {
                  if (window.supabase) {
                    console.warn('âš ï¸ Supabase ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ë¡œë“œë˜ì—ˆì§€ë§Œ í´ë¼ì´ì–¸íŠ¸ ì¸ìŠ¤í„´ìŠ¤(window.supabaseInstance)ê°€ ì—†ìŠµë‹ˆë‹¤. supabase-config.js ì´ˆê¸°í™” í™•ì¸ í•„ìš”.');
                  }
                  throw new Error('Supabase ì„¤ì •ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤. (supabase-config.js í™•ì¸ í•„ìš”)');
                }

                console.log('ğŸ” ê´€ë¦¬ì ì •ë³´ ì¡°íšŒ ì‹œì‘:', id);

                // ì´ë¯¸ì§€ image_8927e3.png í™•ì¸ ê²°ê³¼: í…Œì´ë¸”ëª… 'admins', ì•„ì´ë”” ì»¬ëŸ¼ 'id'
                const { data: user, error } = await sb
                    .from('admins')
                    .select('*')
                    .eq('id', id)
                    .single();

                if (error || !user) {
                    console.warn('âš ï¸ ì‚¬ìš©ì ì¡°íšŒ ì‹¤íŒ¨:', error?.message);
                    throw new Error('ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                }

                console.log('âœ… ì‚¬ìš©ì ë°ì´í„° í™•ì¸ ì„±ê³µ');

                // DBì˜ ë¹„ë°€ë²ˆí˜¸(admin!@34)ì™€ ì§ì ‘ ë¹„êµ
                if (user.password === password) {
                    console.log('ğŸ‰ ë¡œê·¸ì¸ ì„±ê³µ!');
                    msg.textContent = 'âœ“ ë¡œê·¸ì¸ ì„±ê³µ! ì ì‹œ í›„ ì´ë™í•©ë‹ˆë‹¤.';
                    msg.style.color = '#27ae60';
                    
                    // ë¡œê·¸ì¸ ì„¸ì…˜ ì €ì¥
                    localStorage.setItem('isAdminLoggedIn', 'true');
                    localStorage.setItem('adminData', JSON.stringify({
                        id: user.id,
                        name: user.name
                    }));
                    
                    setTimeout(() => { location.href = './admin.html'; }, 800);
                } else {
                    throw new Error('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                }

            } catch (err) {
                console.error('ğŸ”´ ë¡œê·¸ì¸ ì—ëŸ¬:', err);
                msg.textContent = err.message;
                msg.style.color = '#e74c3c';
            }
        });
    });
  </script>
</body>
</html>